pipeline {
    environment {
    NAME = "gitfocus_angular"
    VERSION = "${env.BUILD_ID}-${env.GIT_COMMIT}"
   	IMAGE = "${NAME}:${VERSION}"
    registry = "daggitfocus/gitfocus_angular_kube"
    registryCredential = 'GitFocus_Docker_ID'
    // dockerImage = ''
  }
   agent any	
   stages {
        stage('Building Image') {	  
            steps {
	            sh 'pwd'
	            sh 'ls -l'
                   script {
                            echo "Running ${VERSION} on ${env.JENKINS_URL}"
                             sh "docker build -t ${NAME} ."
            				 sh "docker tag ${NAME}:latest ${NAME}:${VERSION}"
                            // dockerImage = docker.build registry + angularimage:1
                            // dockerImage = docker.build registry + ":1.1"
                   }
            }           
        }	
        stage('Clean Up'){
            steps {
                sh 'rm -r src output  e2e'
                sh 'rm -f browserslist tsconfig.app.json README.md tsconfig.json angular.json  tsconfig.spec.json karma.conf.js  tslint.json index.d.ts'
            }
        }	
        stage('Push to DockerHub') {
            steps{
                  script {
                            docker.withRegistry( '', registryCredential ) {
                            dockerImage.push()
                            
                            dockerImage.push()+ ':${BUILD_NUMBER}'
                            
                           }
                  }
             }
        }
    }
    post {
          always {
		  cleanWs()
	           /*emailext body:'''${DEFAULT_CONTENT}''',
                           recipientProviders: [[$class: 'DevelopersRecipientProvider'], [$class: 'RequesterRecipientProvider']],
                           subject:''' ${DEFAULT_SUBJECT}'''*/
         }  
   }
}
